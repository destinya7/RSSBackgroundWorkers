using RSSBackgroundWorkerBusiness.Models;
using RSSFetcherService.Utils;
using System.Xml;
using Xunit;

namespace RSSFetcherService.Tests.Utils
{
    public class RSSParserTests
    {
        [Fact]
        public void ParseRSS_Throws_Root_Element_Missing()
        {
            var xmlString = "";
            RSSParser rssParser = new RSSParser();
            Assert.Throws<XmlException>(() => rssParser.ParseRSS(xmlString));
        }

        [Fact]
        public void ParseRSS_Is_Not_Null()
        {
            string xmlString = "<?xml version=\"1.0\" encoding=\"UTF-8\"?> <rss xmlns:atom=\"http://www.w3.org/2005/Atom\" xmlns:content=\"http://purl.org/rss/1.0/modules/content/\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:media=\"http://search.yahoo.com/mrss/\" version=\"2.0\"> <channel> <title><![CDATA[CNN.com - RSS Channel - App International Edition]]></title> <description><![CDATA[CNN.com delivers up-to-the-minute news and information on the latest top stories, weather, entertainment, politics and more.]]></description> <link>https://www.cnn.com/app-international-edition/index.html</link> <image> <url>http://i2.cdn.turner.com/cnn/2015/images/09/24/cnn.digital.png</url> <title>CNN.com - RSS Channel - App International Edition</title> <link>https://www.cnn.com/app-international-edition/index.html</link> </image> <pubDate>Tue, 24 Dec 2019 02:34:11 GMT</pubDate> <ttl>10</ttl> <atom10:link xmlns:atom10=\"http://www.w3.org/2005/Atom\" rel=\"self\" type=\"application/rss+xml\" href=\"http://rss.cnn.com/rss/edition\" /> <feedburner:info xmlns:feedburner=\"http://rssnamespace.org/feedburner/ext/1.0\" uri=\"rss/edition\" /> <atom10:link xmlns:atom10=\"http://www.w3.org/2005/Atom\" rel=\"hub\" href=\"http://pubsubhubbub.appspot.com/\" /> <item> <title><![CDATA[In Asia Pacific the climate crisis is happening now, not in the future]]></title> <description><![CDATA[The world's most disaster-prone region felt the harsh reality of the climate crisis in 2019.]]></description> <link>https://www.cnn.com/2019/12/23/asia/asia-pacific-climate-crisis-intl-hnk/index.html</link> <guid isPermaLink=\"true\">https://www.cnn.com/2019/12/23/asia/asia-pacific-climate-crisis-intl-hnk/index.html</guid> <pubDate>Tue, 24 Dec 2019 02:50:36 GMT</pubDate> </item> <item> <title><![CDATA[Woman shames would-be porch pirate at neighbor's house]]></title> <description><![CDATA[A would-be porch pirate in Glendale, California, was in for a surprise when he tried to steal a package from someone's porch and their neighbor intervened.]]></description> <link>https://www.cnn.com/videos/us/2019/12/21/neighbor-shames-would-be-porch-pirate-holiday-package-thief-ndwknd-vpx.cnn</link> <guid isPermaLink=\"true\">https://www.cnn.com/videos/us/2019/12/21/neighbor-shames-would-be-porch-pirate-holiday-package-thief-ndwknd-vpx.cnn</guid> <pubDate>Sat, 21 Dec 2019 14:00:33 GMT</pubDate> </item> <item> <title><![CDATA[Police spread Christmas cheer by giving out candy instead of tickets]]></title> <description><![CDATA[Some drivers in Boise, Idaho, have gotten a jolly surprise after seeing flashing blue lights in their rear-view mirrors: police are giving out candy instead of tickets for some minor offenses.]]></description> <link>https://www.cnn.com/2019/12/23/us/boise-police-candy-instead-of-traffic-tickets-trnd/index.html</link> <guid isPermaLink=\"true\">https://www.cnn.com/2019/12/23/us/boise-police-candy-instead-of-traffic-tickets-trnd/index.html</guid> <pubDate>Mon, 23 Dec 2019 21:39:48 GMT</pubDate> </item> </channel> </rss>";
            RSSParser rssParser = new RSSParser();
            Channel channel = rssParser.ParseRSS(xmlString);

            Assert.NotNull(channel);
        }

        [Fact]
        public void ParseRSS_Has_Title()
        {
            string xmlString = "<?xml version=\"1.0\" encoding=\"UTF-8\"?> <rss xmlns:atom=\"http://www.w3.org/2005/Atom\" xmlns:content=\"http://purl.org/rss/1.0/modules/content/\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:media=\"http://search.yahoo.com/mrss/\" version=\"2.0\"> <channel> <title><![CDATA[CNN.com - RSS Channel - App International Edition]]></title> <description><![CDATA[CNN.com delivers up-to-the-minute news and information on the latest top stories, weather, entertainment, politics and more.]]></description> <link>https://www.cnn.com/app-international-edition/index.html</link> <image> <url>http://i2.cdn.turner.com/cnn/2015/images/09/24/cnn.digital.png</url> <title>CNN.com - RSS Channel - App International Edition</title> <link>https://www.cnn.com/app-international-edition/index.html</link> </image> <pubDate>Tue, 24 Dec 2019 02:34:11 GMT</pubDate> <ttl>10</ttl> <atom10:link xmlns:atom10=\"http://www.w3.org/2005/Atom\" rel=\"self\" type=\"application/rss+xml\" href=\"http://rss.cnn.com/rss/edition\" /> <feedburner:info xmlns:feedburner=\"http://rssnamespace.org/feedburner/ext/1.0\" uri=\"rss/edition\" /> <atom10:link xmlns:atom10=\"http://www.w3.org/2005/Atom\" rel=\"hub\" href=\"http://pubsubhubbub.appspot.com/\" /> <item> <title><![CDATA[In Asia Pacific the climate crisis is happening now, not in the future]]></title> <description><![CDATA[The world's most disaster-prone region felt the harsh reality of the climate crisis in 2019.]]></description> <link>https://www.cnn.com/2019/12/23/asia/asia-pacific-climate-crisis-intl-hnk/index.html</link> <guid isPermaLink=\"true\">https://www.cnn.com/2019/12/23/asia/asia-pacific-climate-crisis-intl-hnk/index.html</guid> <pubDate>Tue, 24 Dec 2019 02:50:36 GMT</pubDate> </item> <item> <title><![CDATA[Woman shames would-be porch pirate at neighbor's house]]></title> <description><![CDATA[A would-be porch pirate in Glendale, California, was in for a surprise when he tried to steal a package from someone's porch and their neighbor intervened.]]></description> <link>https://www.cnn.com/videos/us/2019/12/21/neighbor-shames-would-be-porch-pirate-holiday-package-thief-ndwknd-vpx.cnn</link> <guid isPermaLink=\"true\">https://www.cnn.com/videos/us/2019/12/21/neighbor-shames-would-be-porch-pirate-holiday-package-thief-ndwknd-vpx.cnn</guid> <pubDate>Sat, 21 Dec 2019 14:00:33 GMT</pubDate> </item> <item> <title><![CDATA[Police spread Christmas cheer by giving out candy instead of tickets]]></title> <description><![CDATA[Some drivers in Boise, Idaho, have gotten a jolly surprise after seeing flashing blue lights in their rear-view mirrors: police are giving out candy instead of tickets for some minor offenses.]]></description> <link>https://www.cnn.com/2019/12/23/us/boise-police-candy-instead-of-traffic-tickets-trnd/index.html</link> <guid isPermaLink=\"true\">https://www.cnn.com/2019/12/23/us/boise-police-candy-instead-of-traffic-tickets-trnd/index.html</guid> <pubDate>Mon, 23 Dec 2019 21:39:48 GMT</pubDate> </item> </channel> </rss>";
            RSSParser rssParser = new RSSParser();
            Channel channel = rssParser.ParseRSS(xmlString);

            Assert.Equal("CNN.com - RSS Channel - App International Edition", channel.Title);
        }

        [Fact]
        public void ParseRSS_Has_Items()
        {
            string xmlString = "<?xml version=\"1.0\" encoding=\"UTF-8\"?> <rss xmlns:atom=\"http://www.w3.org/2005/Atom\" xmlns:content=\"http://purl.org/rss/1.0/modules/content/\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:media=\"http://search.yahoo.com/mrss/\" version=\"2.0\"> <channel> <title><![CDATA[CNN.com - RSS Channel - App International Edition]]></title> <description><![CDATA[CNN.com delivers up-to-the-minute news and information on the latest top stories, weather, entertainment, politics and more.]]></description> <link>https://www.cnn.com/app-international-edition/index.html</link> <image> <url>http://i2.cdn.turner.com/cnn/2015/images/09/24/cnn.digital.png</url> <title>CNN.com - RSS Channel - App International Edition</title> <link>https://www.cnn.com/app-international-edition/index.html</link> </image> <pubDate>Tue, 24 Dec 2019 02:34:11 GMT</pubDate> <ttl>10</ttl> <atom10:link xmlns:atom10=\"http://www.w3.org/2005/Atom\" rel=\"self\" type=\"application/rss+xml\" href=\"http://rss.cnn.com/rss/edition\" /> <feedburner:info xmlns:feedburner=\"http://rssnamespace.org/feedburner/ext/1.0\" uri=\"rss/edition\" /> <atom10:link xmlns:atom10=\"http://www.w3.org/2005/Atom\" rel=\"hub\" href=\"http://pubsubhubbub.appspot.com/\" /> <item> <title><![CDATA[In Asia Pacific the climate crisis is happening now, not in the future]]></title> <description><![CDATA[The world's most disaster-prone region felt the harsh reality of the climate crisis in 2019.]]></description> <link>https://www.cnn.com/2019/12/23/asia/asia-pacific-climate-crisis-intl-hnk/index.html</link> <guid isPermaLink=\"true\">https://www.cnn.com/2019/12/23/asia/asia-pacific-climate-crisis-intl-hnk/index.html</guid> <pubDate>Tue, 24 Dec 2019 02:50:36 GMT</pubDate> </item> <item> <title><![CDATA[Woman shames would-be porch pirate at neighbor's house]]></title> <description><![CDATA[A would-be porch pirate in Glendale, California, was in for a surprise when he tried to steal a package from someone's porch and their neighbor intervened.]]></description> <link>https://www.cnn.com/videos/us/2019/12/21/neighbor-shames-would-be-porch-pirate-holiday-package-thief-ndwknd-vpx.cnn</link> <guid isPermaLink=\"true\">https://www.cnn.com/videos/us/2019/12/21/neighbor-shames-would-be-porch-pirate-holiday-package-thief-ndwknd-vpx.cnn</guid> <pubDate>Sat, 21 Dec 2019 14:00:33 GMT</pubDate> </item> <item> <title><![CDATA[Police spread Christmas cheer by giving out candy instead of tickets]]></title> <description><![CDATA[Some drivers in Boise, Idaho, have gotten a jolly surprise after seeing flashing blue lights in their rear-view mirrors: police are giving out candy instead of tickets for some minor offenses.]]></description> <link>https://www.cnn.com/2019/12/23/us/boise-police-candy-instead-of-traffic-tickets-trnd/index.html</link> <guid isPermaLink=\"true\">https://www.cnn.com/2019/12/23/us/boise-police-candy-instead-of-traffic-tickets-trnd/index.html</guid> <pubDate>Mon, 23 Dec 2019 21:39:48 GMT</pubDate> </item> </channel> </rss>";
            RSSParser rssParser = new RSSParser();
            Channel channel = rssParser.ParseRSS(xmlString);

            Assert.Equal(3, channel.Articles.Count);
        }
    }
}
